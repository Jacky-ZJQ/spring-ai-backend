server:
  port: 8080
# 日志
logging:
  level:
    com.jacky.ai: debug # 本项目的日志级别
#    org.springframework.ai: debug # AI对话的日志级别
#    org.springframework.ai.chat.metadata.ChatResponseMetadata: WARN


spring:
  application:
    name: spring-ai-demo

  # 文件上传大小配置
  servlet:
    multipart:
      max-file-size: 104857600
      max-request-size: 104857600

  # mysql数据库
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/itheima?serverTimezone=Asia/Shanghai&useSSL=false&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&transformedBitIsBoolean=true&tinyInt1isBit=false&allowPublicKeyRetrieval=true&allowMultiQueries=true&useServerPrepStmts=false
    username: root
    password: 1234

  # 大模型配置
  ai:
    # 本地ollama部署
    ollama:
      base-url: http://localhost:11434 # ollama服务地址， 这就是默认值
      # 配置本地部署的文本聊天模型
      chat:
        model: deepseek-r1:1.5b # 模型名称
        options:
          temperature: 0.8 # 模型温度，影响模型生成结果的随机性，越小越稳定

    # 开发大模型API
    openai:
      base-url: https://dashscope.aliyuncs.com/compatible-mode
      # 此处为了防止api-key泄露，我们使用了${OPENAI_API_KEY}来读取环境变量。
      api-key: ${OPENAI_API_KEY}
      # 聊天模型（chat）
      chat:
        options:
          model: qwen-max-latest # 可选择的模型列表 https://help.aliyun.com/zh/model-studio/getting-started/models
          temperature: 0.8 # 模型温度，值越大，输出结果越随机
      # 向量模型（RAG）
      embedding:
        options:
          model: text-embedding-v3
          dimensions: 1024

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true

app:
  skills:
    enabled: ${SKILLS_ENABLED:true}
    history-type: ${SKILLS_HISTORY_TYPE:skill}
    default-conversation-prefix: ${SKILLS_DEFAULT_PREFIX:skill}
    definitions:
      - code: general-assistant
        name: 通用助手
        description: 基于本地模型的通用问答技能
        # 可按环境覆盖为 serviceOpenAiChatClient，避免依赖本地 Ollama
        client-bean: ${SKILL_GENERAL_CLIENT_BEAN:ollamaChatClient}
        mode: STREAM
        conversation-prefix: general
        welcome-message: 你好，我是通用助手，欢迎提问。
        enabled: true
      - code: course-advisor
        name: 课程顾问
        description: 课程咨询与预约办理技能
        client-bean: serviceOpenAiChatClient
        mode: SYNC
        conversation-prefix: course
        welcome-message: 你好，我是课程顾问助手。
        enabled: true

  mcp:
    enabled: ${MCP_ENABLED:true}
    server-name: ${MCP_SERVER_NAME:spring-ai-mcp-gateway}
    server-version: ${MCP_SERVER_VERSION:1.0.0}
    session-ttl-seconds: ${MCP_SESSION_TTL_SECONDS:1800}
    auto-register-unconfigured-tools: ${MCP_AUTO_REGISTER_UNCONFIGURED_TOOLS:true}
    protocol-versions:
      - "2025-11-05"
      - "2025-06-18"
      - "2025-03-26"
      - "2024-11-05"
    tools:
      - name: query_course
        title: 课程查询
        description: 根据课程类型和学历条件查询课程列表
        input-schema:
          type: object
          properties:
            type:
              type: string
              description: 课程类型
            edu:
              type: integer
              description: 学历要求，取值 0-4
        read-only-hint: true
        idempotent-hint: true
        enabled: true

      - name: query_all_schools
        title: 校区查询
        description: 查询全部校区
        input-schema:
          type: object
          properties: { }
        read-only-hint: true
        idempotent-hint: true
        enabled: true

      - name: generate_course_reservation
        title: 生成预约单
        description: 生成课程预约单并返回预约编号
        input-schema:
          type: object
          required: [ courseName, studentName, contactInfo, school ]
          properties:
            courseName:
              type: string
            studentName:
              type: string
            contactInfo:
              type: string
            school:
              type: string
            remark:
              type: string
        read-only-hint: false
        idempotent-hint: false
        enabled: true

      - name: skill_chat_once
        title: 技能问答
        description: 通过技能中心发起一次同步问答
        input-schema:
          type: object
          required: [ skillCode, prompt ]
          properties:
            skillCode:
              type: string
            prompt:
              type: string
            chatId:
              type: string
        read-only-hint: true
        idempotent-hint: false
        enabled: true
